(this["webpackJsonpcupid-me"]=this["webpackJsonpcupid-me"]||[]).push([[0],{46:function(e,t,a){e.exports=a(62)},51:function(e,t,a){},52:function(e,t,a){},56:function(e,t,a){},62:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(36),o=a.n(l),c=(a(51),a(52),a(10)),u=a(24),i={authenticated:!1,authType:null},s=Object(n.createContext)(Object(u.a)({},i,{dispatch:function(e){}})),m=s.Provider,p=function(e,t){switch(t.type){case"LOGIN":return Object(u.a)({},e,{authenticated:!0,authType:t.payload});case"LOGOUT":return Object(u.a)({},e,{authenticated:!1,authType:null});default:return e}},d=function(e){var t=Object(n.useReducer)(p,i),a=Object(c.a)(t,2),l=a[0],o=a[1];return r.a.createElement(m,{value:{authenticated:l.authenticated,authType:l.authType,dispatch:o}},e.children)},g=function(e){Object(n.useContext)(s);return r.a.createElement("div",null,r.a.createElement("p",null,"Home"))},h=a(20),f=a(23),E=a(19),v=a(21),b=a.n(v);function y(){var e=Object(h.a)(["\n  mutation login(\n    $email:String!\n    $password:String!\n  ){\n    login(\n      loginInput: {\n        email:$email\n        password:$password\n      }\n    ) {\n      token\n    }\n  }\n\n"]);return y=function(){return e},e}var w=b()(y()),O=function(e){var t=Object(n.useContext)(s),a=Object(n.useState)({success:!1,authType:""}),l=Object(c.a)(a,2),o=l[0],u=l[1];t.authenticated&&e.history.push("/");var i=Object(E.a)(w,{update:function(e,t){var a=t.data,n="Manual_".concat(a.login.token);localStorage.setItem("jwt_token",n),u({success:!0,authType:"manual"})},onError:function(e){console.log(e)}}),m=Object(c.a)(i,2),p=m[0],d=(m[1].data,function(e){return!isNaN(parseFloat(e))&&isFinite(e)});return Object(n.useEffect)((function(){return o.success&&(t.dispatch({type:"LOGIN",payload:o.authType}),e.history.push({pathname:"/profile"})),function(){}}),[o]),r.a.createElement("div",{className:"App"},r.a.createElement("h1",null,"LOGIN"),r.a.createElement("div",null,r.a.createElement(f.GoogleLogin,{clientId:"118933481211-a6k3dqiuk0l1jv69kbkm89m79rc765vn.apps.googleusercontent.com",buttonText:"LOGIN WITH GOOGLE",onSuccess:function(e){if(d(e.googleId)){var t="Google_".concat(e.tokenId);localStorage.setItem("jwt_token",t),u({success:!0,authType:"google"})}},onFailure:function(e){console.log(e)}}),r.a.createElement("button",{onClick:function(e){return p({variables:{email:"ayra@email.com",password:"secret"}})}},"Login"),r.a.createElement("p",null,"Not authenticated")))},j=a(43);a(56);function k(){var e=Object(h.a)(["\n    mutation signUp(\n      $email:String!\n      $username:String!\n      $password:String!\n      $authType:String!\n    ){\n      signUp(\n        registerInput: {\n          username:$username\n          email:$email\n          password:$password\n          authType:$authType\n        }\n      ) {\n        token\n      }\n    }"]);return k=function(){return e},e}var S=function(e){var t=Object(n.useState)({success:!1,authType:""}),a=Object(c.a)(t,2),l=a[0],o=a[1],i=b()(k()),m=Object(n.useState)({token:"",acquired:!1,email:""}),p=Object(c.a)(m,2),d=p[0],g=p[1],h=Object(j.a)(),v=h.register,y=h.handleSubmit,w=h.watch,O=h.errors,S=Object(n.useContext)(s);S.authenticated&&e.history.push("/");var I=Object(E.a)(i,{update:function(e,t){var a=t.data;if(d.acquired){var n="Google_".concat(d.token);localStorage.setItem("jwt_token",n),o({success:!0,authType:"google"})}else{var r="Manual_".concat(a.signUp.token);localStorage.setItem("jwt_token",r),o({success:!0,authType:"manual"})}console.log(a)},onError:function(e){console.log(e)}}),T=Object(c.a)(I,2),x=T[0],G=T[1],L=(G.loading,G.data,G.error,function(e){return!isNaN(parseFloat(e))&&isFinite(e)});return Object(n.useEffect)((function(){return l.success&&(S.dispatch({type:"LOGIN",payload:l.authType}),e.history.push({pathname:"/profile"})),function(){}}),[l]),r.a.createElement("div",null,r.a.createElement("h1",null,"SIGN UP"),d.acquired?r.a.createElement("div",null,d.token,r.a.createElement("form",{name:"form-google",className:"google-signup-form",onSubmit:y((function(e){x({variables:{username:e.google_username,password:e.google_password,authType:"google",email:d.email}}),console.log(e)}))},r.a.createElement("input",{type:"text",name:"google_username",placeholder:"insert valid username",ref:v({required:!0,maxLength:15})}),O.google_username&&r.a.createElement("p",null,"username is required"),r.a.createElement("input",{type:"password",name:"google_password",placeholder:"insert valid password",ref:v({required:!0})}),O.google_password&&r.a.createElement("p",null,"password is required"),r.a.createElement("input",{name:"google_passwordmatch",type:"password",placeholder:"passwords must match",ref:v({required:!0,validate:function(e){return e===w("google_password")}})}),O.google_passwordmatch&&r.a.createElement("p",null,"passwords do not match"),r.a.createElement("input",{type:"submit"}))):r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(f.GoogleLogin,{clientId:"118933481211-a6k3dqiuk0l1jv69kbkm89m79rc765vn.apps.googleusercontent.com",buttonText:"SIGN UP WITH GOOGLE",onSuccess:function(e){L(e.googleId)&&g({token:e.tokenId,acquired:!0,email:e.profileObj.email})},onFailure:function(e){console.log(e)}})),r.a.createElement("div",null,r.a.createElement("form",{name:"form-manual",className:"manual-signup-form",onSubmit:y((function(e){x({variables:Object(u.a)({},e,{authType:"manual"})}),console.log(e)}))},r.a.createElement("input",{type:"text",name:"username",placeholder:"insert valid username",ref:v({required:!0,maxLength:15})}),O.username&&r.a.createElement("p",null,"username is required"),r.a.createElement("input",{type:"text",name:"email",placeholder:"insert valid email",ref:v({required:!0,pattern:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/})}),O.email&&r.a.createElement("p",null,"please insert a valid email"),r.a.createElement("input",{type:"password",name:"password",placeholder:"insert valid password",ref:v({required:!0})}),O.password&&r.a.createElement("p",null,"password is required"),r.a.createElement("input",{name:"passwordmatch",type:"password",placeholder:"passwords must match",ref:v({required:!0,validate:function(e){return e===w("password")}})}),O.passwordmatch&&r.a.createElement("p",null,"passwords do not match"),r.a.createElement("input",{type:"submit"})))))},I=function(e){return Object(n.useContext)(s).authenticated?r.a.createElement("div",null,r.a.createElement("p",null,"Discover")):(e.history.push("/"),null)};function T(){var e=Object(h.a)(["\n  {\n    getProfileGoogle {\n      name\n      email\n      picture\n    }\n  }\n"]);return T=function(){return e},e}function x(){var e=Object(h.a)(["\n  {\n    getProfileManual {\n      email\n      username\n    }\n  }\n"]);return x=function(){return e},e}var G=b()(x()),L=b()(T()),_=function(e){var t=Object(n.useContext)(s);localStorage.setItem("appState",JSON.stringify(t));var a="manual"===t.authType?G:L,l=Object(E.b)(a),o=l.loading,c=l.error,u=l.data;return o?r.a.createElement("p",null,"Loading..."):c?r.a.createElement("p",null,"Error"):"manual"===t.authType?r.a.createElement("div",null,r.a.createElement("p",null,u.getProfileManual.email)):r.a.createElement("div",null,r.a.createElement("p",null,u.getProfileGoogle.email))},q=function(e){var t=Object(n.useContext)(s);return t.authenticated?r.a.createElement("div",null,r.a.createElement("p",null,"Profile"),t.authenticated?r.a.createElement(_,e):null):(e.history.push("/"),null)},N=a(18),$=a(16),P=a(9),C=function(e){var t=Object(n.useContext)(s);Object(n.useEffect)((function(){var e=JSON.parse(localStorage.getItem("appState"));return e&&t.dispatch({type:"LOGIN",payload:e.authType}),function(){}}),[]);var a=function(){localStorage.removeItem("jwt_token"),localStorage.removeItem("appState"),t.dispatch({type:"LOGOUT"})},l="google"===t.authType?r.a.createElement(f.GoogleLogout,{clientId:"658977310896-knrl3gka66fldh83dao2rhgbblmd4un9.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:a}):r.a.createElement("button",{onClick:a},"Logout");return r.a.createElement("nav",null,r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(N.b,{to:"/"},r.a.createElement("button",null,"Home"))),r.a.createElement("li",null,r.a.createElement(N.b,{to:"/login"},r.a.createElement("button",null,"Login"))),r.a.createElement("li",null,r.a.createElement(N.b,{to:"/register"},r.a.createElement("button",null,"Register"))),r.a.createElement("li",null,r.a.createElement(N.b,{to:"/profile"},r.a.createElement("button",null,"Profile"))),r.a.createElement("li",null,r.a.createElement(N.b,{to:"/discover"},r.a.createElement("button",null,"Discover")))),!0===t.authenticated?r.a.createElement("div",null," ",l," "):null)},U=a(17),F=a(44),H=a(45),J=a(13),M=new H.a({uri:"http://localhost:4000",credentials:"include"}),W=new J.a((function(e,t){var a=localStorage.getItem("jwt_token");return e.setContext({headers:{authorization:a?"Bearer ".concat(a):""}}),t(e)})),z=new U.c({link:W.concat(M),cache:new F.a,defaultOptions:{watchQuery:{fetchPolicy:"network-only",errorPolicy:"all"},query:{fetchPolicy:"network-only",errorPolicy:"all"}}}),A=function(){return r.a.createElement(P.a,{client:z},r.a.createElement(d,null,r.a.createElement(N.a,null,r.a.createElement(C,null),r.a.createElement($.a,{exact:!0,path:"/",component:g}),r.a.createElement($.a,{exact:!0,path:"/login",component:O}),r.a.createElement($.a,{exact:!0,path:"/register",component:S}),r.a.createElement($.a,{exact:!0,path:"/discover",component:I}),r.a.createElement($.a,{exact:!0,path:"/profile",component:q}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[46,1,2]]]);
//# sourceMappingURL=main.ecab59b8.chunk.js.map